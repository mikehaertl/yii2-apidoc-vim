
*yii/sphinx/Query*   >> |yii/db/Query|
==================

SUBCLASSES
------------------------------------------------------------------------------

|yii/sphinx/ActiveQuery|

DESCRIPTION
------------------------------------------------------------------------------

 Query provides a set of methods to facilitate the specification of different
 clauses in a SELECT statement. These methods can be chained together.

 By calling 'createCommand()', we can get a 'Command' instance which can be
 further used to perform/execute the Sphinx query.

 For example,

   $query = new Query();
   $query->select('id, group_id')
       ->from('idx_item')
       ->limit(10);
   // build and execute the query
   $command = $query->createCommand();
   // $command->sql returns the actual SQL
   $rows = $command->queryAll();

 Since Sphinx does not store the original indexed text, the snippets for the
 rows in query result should be build separately via another query. You can
 simplify this workflow using 'snippetCallback'.

 Warning: even if you do not set any query limit, implicit LIMIT 0,20 is
 present by default!


PROPERTY DETAILS
------------------------------------------------------------------------------

$where					*yii/sphinx/Query::$where*

 See |yii/db/QueryTrait::$where|

$limit					*yii/sphinx/Query::$limit*

 See |yii/db/QueryTrait::$limit|

$offset					*yii/sphinx/Query::$offset*

 See |yii/db/QueryTrait::$offset|

$orderBy				*yii/sphinx/Query::$orderBy*

 See |yii/db/QueryTrait::$orderBy|

$indexBy				*yii/sphinx/Query::$indexBy*

 See |yii/db/QueryTrait::$indexBy|

$emulateExecution			*yii/sphinx/Query::$emulateExecution*

 See |yii/db/QueryTrait::$emulateExecution|

$select					*yii/sphinx/Query::$select*

 See |yii/db/Query::$select|

$selectOption				*yii/sphinx/Query::$selectOption*

 See |yii/db/Query::$selectOption|

$distinct				*yii/sphinx/Query::$distinct*

 See |yii/db/Query::$distinct|

$from					*yii/sphinx/Query::$from*

 See |yii/db/Query::$from|

$groupBy				*yii/sphinx/Query::$groupBy*

 See |yii/db/Query::$groupBy|

$join					*yii/sphinx/Query::$join*

 See |yii/db/Query::$join|

$having					*yii/sphinx/Query::$having*

 See |yii/db/Query::$having|

$union					*yii/sphinx/Query::$union*

 See |yii/db/Query::$union|

$params					*yii/sphinx/Query::$params*

 See |yii/db/Query::$params|

$match					*yii/sphinx/Query::$match*

 (string|\yii\db\Expression) Text, which should be searched in fulltext mode.
 This value will be composed into MATCH operator inside the WHERE clause.
 Note: this value will be processed by 'Connection::escapeMatchValue()', if
 you need to compose complex match condition use 'Expression', see 'match()'
 for details.

$within					*yii/sphinx/Query::$within*

 (string) WITHIN GROUP ORDER BY clause. This is a Sphinx specific extension
 that lets you control how the best row within a group will to be selected.
 The possible value matches the 'orderBy' one.

$options				*yii/sphinx/Query::$options*

 (array) Per-query options in format: optionName => optionValue They will
 compose OPTION clause. This is a Sphinx specific extension that lets you
 control a number of per-query options.

$snippetCallback			*yii/sphinx/Query::$snippetCallback*

 (callable) PHP callback, which should be used to fetch source data for the
 snippets. Such callback will receive array of query result rows as an
 argument and must return the array of snippet source strings in the order,
 which match one of incoming rows. For example:

   $query = new Query();
   $query->from('idx_item')
       ->match('pencil')
       ->snippetCallback(function ($rows) {
           $result = [];
           foreach ($rows as $row) {
               $result[] = file_get_contents('/path/to/index/files/' .
 $row['id'] . '.txt');
           }
           return $result;
       })
       ->all();



$snippetOptions				*yii/sphinx/Query::$snippetOptions*

 (array) Query options for the call snippet.

$facets					*yii/sphinx/Query::$facets*

 (array) Facet search specifications. For example:

   [
       'group_id',
       'brand_id' => [
           'order' => ['COUNT(*)' => SORT_ASC],
       ],
       'price' => [
           'select' => 'INTERVAL(price,200,400,600,800) AS price',
           'order' => ['FACET()' => SORT_ASC],
       ],
       'name_in_json' => [
           'select' => [new Expression('json_attr.name AS name_in_json')],
       ],
   ]

 You need to use 'search()' method in order to fetch facet results.

 Note: if you specify custom select for the facet, ensure facet name has
 corresponding column inside it.

$showMeta				*yii/sphinx/Query::$showMeta*

 (bool|string|\yii\db\Expression) Whether to automatically perform 'SHOW META'
 query against main one. You may set this value to be string or 'Expression'
 instance, in this case its value will be used as 'LIKE' condition for 'SHOW
 META' statement. You need to use 'search()' method in order to fetch 'meta'
 results.

$groupLimit				*yii/sphinx/Query::$groupLimit*

 (int) Groups limit: to return (no more than) N top matches for each group.
 This option will take effect only if 'groupBy' is set.



METHOD DETAILS
------------------------------------------------------------------------------


*yii/sphinx/Query::className*				public

 See |yii/base/BaseObject::className|


*yii/sphinx/Query::__construct*				public

 See |yii/base/BaseObject::__construct|


*yii/sphinx/Query::init*					public

 See |yii/base/BaseObject::init|


*yii/sphinx/Query::__get*					public

 See |yii/base/Component::__get|


*yii/sphinx/Query::__set*					public

 See |yii/base/Component::__set|


*yii/sphinx/Query::__isset*				public

 See |yii/base/Component::__isset|


*yii/sphinx/Query::__unset*				public

 See |yii/base/Component::__unset|


*yii/sphinx/Query::__call*				public

 See |yii/base/Component::__call|


*yii/sphinx/Query::hasProperty*				public

 See |yii/base/Component::hasProperty|


*yii/sphinx/Query::canGetProperty*			public

 See |yii/base/Component::canGetProperty|


*yii/sphinx/Query::canSetProperty*			public

 See |yii/base/Component::canSetProperty|


*yii/sphinx/Query::hasMethod*				public

 See |yii/base/Component::hasMethod|


*yii/sphinx/Query::__clone*				public

 See |yii/base/Component::__clone|


*yii/sphinx/Query::behaviors*				public

 See |yii/base/Component::behaviors|


*yii/sphinx/Query::hasEventHandlers*			public

 See |yii/base/Component::hasEventHandlers|


*yii/sphinx/Query::on*					public

 See |yii/base/Component::on|


*yii/sphinx/Query::off*					public

 See |yii/base/Component::off|


*yii/sphinx/Query::trigger*				public

 See |yii/base/Component::trigger|


*yii/sphinx/Query::getBehavior*				public

 See |yii/base/Component::getBehavior|


*yii/sphinx/Query::getBehaviors*				public

 See |yii/base/Component::getBehaviors|


*yii/sphinx/Query::attachBehavior*			public

 See |yii/base/Component::attachBehavior|


*yii/sphinx/Query::attachBehaviors*			public

 See |yii/base/Component::attachBehaviors|


*yii/sphinx/Query::detachBehavior*			public

 See |yii/base/Component::detachBehavior|


*yii/sphinx/Query::detachBehaviors*			public

 See |yii/base/Component::detachBehaviors|


*yii/sphinx/Query::ensureBehaviors*			public

 See |yii/base/Component::ensureBehaviors|


*yii/sphinx/Query::indexBy*				public

 See |yii/db/QueryTrait::indexBy|


*yii/sphinx/Query::where*					public

 See |yii/db/QueryTrait::where|


*yii/sphinx/Query::andWhere*				public

 See |yii/db/QueryTrait::andWhere|


*yii/sphinx/Query::orWhere*				public

 See |yii/db/QueryTrait::orWhere|


*yii/sphinx/Query::filterWhere*				public

 See |yii/db/QueryTrait::filterWhere|


*yii/sphinx/Query::andFilterWhere*			public

 See |yii/db/QueryTrait::andFilterWhere|


*yii/sphinx/Query::orFilterWhere*				public

 See |yii/db/QueryTrait::orFilterWhere|


*yii/sphinx/Query::filterCondition*			protected

 See |yii/db/QueryTrait::filterCondition|


*yii/sphinx/Query::isEmpty*				protected

 See |yii/db/QueryTrait::isEmpty|


*yii/sphinx/Query::orderBy*				public

 See |yii/db/QueryTrait::orderBy|


*yii/sphinx/Query::addOrderBy*				public

 See |yii/db/QueryTrait::addOrderBy|


*yii/sphinx/Query::normalizeOrderBy*			protected

 See |yii/db/QueryTrait::normalizeOrderBy|


*yii/sphinx/Query::limit*					public

 See |yii/db/QueryTrait::limit|


*yii/sphinx/Query::offset*				public

 See |yii/db/QueryTrait::offset|


*yii/sphinx/Query::emulateExecution*			public

 See |yii/db/QueryTrait::emulateExecution|


*yii/sphinx/Query::createCommand*				public
>
 createCommand($db='null')
<
return (\yii\sphinx\Command) The created Sphinx command instance.

    [$db] (\yii\sphinx\Connection) The Sphinx connection used to generate the
    SQL statement. If this parameter is not given, the 'sphinx' application
    component will be used.


*yii/sphinx/Query::prepare*				public

 See |yii/db/Query::prepare|


*yii/sphinx/Query::batch*					public

 See |yii/db/Query::batch|


*yii/sphinx/Query::each*					public

 See |yii/db/Query::each|


*yii/sphinx/Query::all*					public

 See |yii/db/Query::all|


*yii/sphinx/Query::populate*				public
>
 populate($rows)
<
return (array) The converted query result



 This method is internally used to convert the data fetched from database into
 the format as required by this query.



    [$rows] (array) The raw query result from database


*yii/sphinx/Query::one*					public
>
 one($db='null')
<
return (array|bool) The first row (in terms of an array) of the query result. False
is returned if the query results in nothing.







    [$db] (\yii\db\Connection) The database connection used to generate the
    SQL statement. If this parameter is not given, the 'db' application
    component will be used.


*yii/sphinx/Query::scalar*				public

 See |yii/db/Query::scalar|


*yii/sphinx/Query::column*				public

 See |yii/db/Query::column|


*yii/sphinx/Query::count*					public

 See |yii/db/Query::count|


*yii/sphinx/Query::sum*					public

 See |yii/db/Query::sum|


*yii/sphinx/Query::average*				public

 See |yii/db/Query::average|


*yii/sphinx/Query::min*					public

 See |yii/db/Query::min|


*yii/sphinx/Query::max*					public

 See |yii/db/Query::max|


*yii/sphinx/Query::exists*				public

 See |yii/db/Query::exists|


*yii/sphinx/Query::queryScalar*				protected
>
 queryScalar($selectExpression, $db)
<
return (bool|string) 



 Restores the value of select to make this query reusable.



    [$selectExpression] (string|\yii\db\Expression) 
    [$db] (\yii\db\Connection|null) 


*yii/sphinx/Query::getTablesUsedInFrom*			public

 See |yii/db/Query::getTablesUsedInFrom|


*yii/sphinx/Query::select*				public

 See |yii/db/Query::select|


*yii/sphinx/Query::addSelect*				public

 See |yii/db/Query::addSelect|


*yii/sphinx/Query::distinct*				public

 See |yii/db/Query::distinct|


*yii/sphinx/Query::from*					public

 See |yii/db/Query::from|


*yii/sphinx/Query::andFilterCompare*			public

 See |yii/db/Query::andFilterCompare|


*yii/sphinx/Query::join*					public
>
 join($type, $table, $on='\'\'', $params='[]')
<
return ($this) The query object itself



 The first parameter specifies what type of join it is.



    [$type] (string) The type of join, such as INNER JOIN, LEFT JOIN.
    [$table] (string|array) The table to be joined.

    Use a string to represent the name of the table to be joined. The table
    name can contain a schema prefix (e.g. 'public.user') and/or table alias
    (e.g. 'user u'). The method will automatically quote the table name unless
    it contains some parenthesis (which means the table is given as a
    sub-query or DB expression).

    Use an array to represent joining with a sub-query. The array must contain
    only one element. The value must be a 'Query' object representing the
    sub-query while the corresponding key represents the alias for the
    sub-query.
    [$on] (string|array) The join condition that should appear in the ON part.
    Please refer to 'where()' on how to specify this parameter.

    Note that the array format of 'where()' is designed to match columns to
    values instead of columns to columns, so the following would **not** work
    as expected: '['post.author_id' => 'user.id']', it would match the
    'post.author_id' column value against the string ''user.id''. It is
    recommended to use the string syntax here which is more suited for a join:

      'post.author_id = user.id'


    [$params] (array) The parameters (name => value) to be bound to the query.


*yii/sphinx/Query::innerJoin*				public
>
 innerJoin($table, $on='\'\'', $params='[]')
<
return ($this) The query object itself







    [$table] (string|array) The table to be joined.

    Use a string to represent the name of the table to be joined. The table
    name can contain a schema prefix (e.g. 'public.user') and/or table alias
    (e.g. 'user u'). The method will automatically quote the table name unless
    it contains some parenthesis (which means the table is given as a
    sub-query or DB expression).

    Use an array to represent joining with a sub-query. The array must contain
    only one element. The value must be a 'Query' object representing the
    sub-query while the corresponding key represents the alias for the
    sub-query.
    [$on] (string|array) The join condition that should appear in the ON part.
    Please refer to 'join()' on how to specify this parameter.
    [$params] (array) The parameters (name => value) to be bound to the query.


*yii/sphinx/Query::leftJoin*				public
>
 leftJoin($table, $on='\'\'', $params='[]')
<
return ($this) The query object itself







    [$table] (string|array) The table to be joined.

    Use a string to represent the name of the table to be joined. The table
    name can contain a schema prefix (e.g. 'public.user') and/or table alias
    (e.g. 'user u'). The method will automatically quote the table name unless
    it contains some parenthesis (which means the table is given as a
    sub-query or DB expression).

    Use an array to represent joining with a sub-query. The array must contain
    only one element. The value must be a 'Query' object representing the
    sub-query while the corresponding key represents the alias for the
    sub-query.
    [$on] (string|array) The join condition that should appear in the ON part.
    Please refer to 'join()' on how to specify this parameter.
    [$params] (array) The parameters (name => value) to be bound to the query


*yii/sphinx/Query::rightJoin*				public
>
 rightJoin($table, $on='\'\'', $params='[]')
<
return ($this) The query object itself







    [$table] (string|array) The table to be joined.

    Use a string to represent the name of the table to be joined. The table
    name can contain a schema prefix (e.g. 'public.user') and/or table alias
    (e.g. 'user u'). The method will automatically quote the table name unless
    it contains some parenthesis (which means the table is given as a
    sub-query or DB expression).

    Use an array to represent joining with a sub-query. The array must contain
    only one element. The value must be a 'Query' object representing the
    sub-query while the corresponding key represents the alias for the
    sub-query.
    [$on] (string|array) The join condition that should appear in the ON part.
    Please refer to 'join()' on how to specify this parameter.
    [$params] (array) The parameters (name => value) to be bound to the query


*yii/sphinx/Query::groupBy*				public

 See |yii/db/Query::groupBy|


*yii/sphinx/Query::addGroupBy*				public

 See |yii/db/Query::addGroupBy|


*yii/sphinx/Query::having*				public

 See |yii/db/Query::having|


*yii/sphinx/Query::andHaving*				public

 See |yii/db/Query::andHaving|


*yii/sphinx/Query::orHaving*				public

 See |yii/db/Query::orHaving|


*yii/sphinx/Query::filterHaving*				public

 See |yii/db/Query::filterHaving|


*yii/sphinx/Query::andFilterHaving*			public

 See |yii/db/Query::andFilterHaving|


*yii/sphinx/Query::orFilterHaving*			public

 See |yii/db/Query::orFilterHaving|


*yii/sphinx/Query::union*					public

 See |yii/db/Query::union|


*yii/sphinx/Query::params*				public

 See |yii/db/Query::params|


*yii/sphinx/Query::addParams*				public

 See |yii/db/Query::addParams|


*yii/sphinx/Query::create*				public
>
 create($from)
<
return (\yii\sphinx\Query) The new Query object

 The properties being copies are the ones to be used by query builders.

    [$from] (\yii\sphinx\Query) The source query object


*yii/sphinx/Query::setConnection*				public
>
 setConnection($connection)
<
return ($this) The query object itself

    [$connection] (\yii\sphinx\Connection) Sphinx connection instance


*yii/sphinx/Query::getConnection*				public
>
 getConnection()
<
return (\yii\sphinx\Connection) Sphinx connection instance



*yii/sphinx/Query::defaultConnection*			protected
>
 defaultConnection()
<
return (\yii\sphinx\Connection) Default connection value.



*yii/sphinx/Query::search*				public
>
 search($db='null')
<
return (array) The query results.

    [$db] (\yii\sphinx\Connection) The Sphinx connection used to generate the
    SQL statement.


*yii/sphinx/Query::match*					public
>
 match($query)
<
return ($this) The query object itself.

 Note: this value will be processed by 'Connection::escapeMatchValue()', if
 you need to compose complex match condition use 'Expression':

   $query = new Query();
   $query->from('my_index')
       ->match(new Expression(':match', ['match' => '@(content) ' .
 Yii::$app->sphinx->escapeMatchValue($matchValue)]))
       ->all();



    [$query] (string|\yii\db\Expression|\yii\sphinx\MatchExpression) Fulltext
    query text.


*yii/sphinx/Query::options*				public
>
 options($options)
<
return ($this) The query object itself

    [$options] (array) Query options in format: optionName => optionValue


*yii/sphinx/Query::addOptions*				public
>
 addOptions($options)
<
return ($this) The query object itself

    [$options] (array) Query options in format: optionName => optionValue


*yii/sphinx/Query::within*				public
>
 within($columns)
<
return ($this) The query object itself

    [$columns] (string|array) The columns (and the directions) to find best
    row within a group. Columns can be specified in either a string (e.g. "id
    ASC, name DESC") or an array (e.g. '['id' => Query::SORT_ASC, 'name' =>
    Query::SORT_DESC]'). The method will automatically quote the column names
    unless a column contains some parenthesis (which means the column contains
    a DB expression).


*yii/sphinx/Query::addWithin*				public
>
 addWithin($columns)
<
return ($this) The query object itself

    [$columns] (string|array) The columns (and the directions) to find best
    row within a group. Columns can be specified in either a string (e.g. "id
    ASC, name DESC") or an array (e.g. '['id' => Query::SORT_ASC, 'name' =>
    Query::SORT_DESC]'). The method will automatically quote the column names
    unless a column contains some parenthesis (which means the column contains
    a DB expression).


*yii/sphinx/Query::groupLimit*				public
>
 groupLimit($limit)
<
return ($this) The query object itself.

 This option will take effect only if 'groupBy' is set.

    [$limit] (int) Group limit.


*yii/sphinx/Query::facets*				public
>
 facets($facets)
<
return ($this) The query object itself

    [$facets] (array) Facet specifications.


*yii/sphinx/Query::addFacets*				public
>
 addFacets($facets)
<
return ($this) The query object itself

    [$facets] (array) Facet specifications.


*yii/sphinx/Query::showMeta*				public
>
 showMeta($showMeta)
<
return ($this) The query object itself

    [$showMeta] (bool|string|\yii\db\Expression) Whether to automatically
    perform 'SHOW META'


*yii/sphinx/Query::snippetCallback*			public
>
 snippetCallback($callback)
<
return ($this) The query object itself

    [$callback] (callable) PHP callback, which should be used to fetch source
    data for the snippets.


*yii/sphinx/Query::snippetOptions*			public
>
 snippetOptions($options)
<
return ($this) The query object itself

    [$options] (array) Call snippet options in format: option_name =>
    option_value


*yii/sphinx/Query::fillUpSnippets*			protected
>
 fillUpSnippets($rows)
<
return (array|\yii\sphinx\ActiveRecord[]) Query result rows with filled up snippets.

    [$rows] (array) Raw query result rows.


*yii/sphinx/Query::callSnippets*				protected
>
 callSnippets($source)
<
return (array) Snippets list.

    [$source] (array) The source data to extract a snippet from.


*yii/sphinx/Query::callSnippetsInternal*			protected
>
 callSnippetsInternal($source, $from)
<
return (array) Snippets list.

    [$source] (array) The source data to extract a snippet from.
    [$from] (string) Name of the source index.



 vim:tw=78:ts=8:ft=help:norl:
